#! Full build for Cradlepoint Modem
#! Created 25.Jan.2018
#!
#!/bin/bash

cd /home/pi

#! Build variables
echo What is the Country location of this PI (AU/BR/CA/NL/UK/US)?
read var_country

echo What is the site location of this PI (First 3 letters // BLU/SAL/WIN)?
read var_site

echo What is the Operator name for this PI (First 3 letters // ASP/SPR/TEL/VIV)?
read var_operator

echo What number monitor is this (1/2/3/4)?
read var_monitor

echo What is the Static IP Address of this PI?
read var_ipaddr

echo What is the Default Gateway of this PI?
read var_defgw

echo What is the IP Address of your Modem
read var_mdm

echo What is the IP Address of your Public CURL endpoint
read var_pubcurl

echo What is the IP Address of your Private CURL endpoint
read var_privcurl

echo What is the IP Address of your primary DNS endpoint
read var_dns1

echo What is the IP Address of your secondary DNS endpoint
read var_dns2

#!echo What is the hostname of this PI [UKWD-APNPI-WGN-205]
var_hostname=$var_country$var_site-APNPI-$var_operator-$var_monitor
#!read var_hostname

echo Are these variables correct?

echo Hostname = $var_hostname

echo Modem = $var_mdm

echo Public CURL endpoint = $var_pubcurl

echo Private CURL endpoint = $var_privcurl

echo Primary DNS endpoint = $var_dns1
 
echo Secondary DNS endpoint = $var_dns2

select yn in "Yes" "No"; do
	case $yn in
		No ) exit;;
		Yes ) break;;
	esac
done

#! Download configuration files

wget http://52.56.99.9/build/radius_mon_build

wget http://52.56.99.9/build/snmpd.conf.emea

wget http://52.56.99.9/build/ssh_start

#! Install Applications

sudo apt-get update -q
sudo apt-get install snmpd snmp sshpass dnsutils -y -q

#! Configure Headless SSH PI

sudo chmod 777 /home/pi/ssh_start

#! Configure SNMP

sudo rm /etc/snmp/snmpd.conf
sudo mv ./snmpd.conf.emea /etc/snmp/snmpd.conf
sudo systemctl restart snmpd

#! Configure CURL routes

sudo touch /home/pi/1_routes
sudo chmod 777 /home/pi/1_routes

echo sudo route add -host $var_pubcurl gw $var_mdm >> /home/pi/1_routes
echo sudo route add -host $var_privcurl gw $var_mdm >> /home/pi/1_routes
echo sudo route add -host $var_dns1 gw $var_mdm >> /home/pi/1_routes
echo sudo route add -host $var_dns2 gw $var_mdm >> /home/pi/1_routes

#! Build rc.local

sudo sed -i "20i /home/pi/ssh_start &" /etc/rc.local
sudo sed -i "21i /home/pi/1_routes &" /etc/rc.local
#!sudo sed -i "22i /sbin/shutdown -r 01:00 &" /etc/rc.local

#! Configure Hostname

sudo sed -i -e 's/'raspberrypi'/'$var_hostname'/g' /etc/hosts
sudo sed -i -e 's/'raspberrypi'/'$var_hostname'/g' /etc/hostname

#! Restart

sudo init 6
